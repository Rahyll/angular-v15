// ==================== DESIGN SYSTEM ====================
// CSS Custom Properties for consistent theming and easier maintenance

// Dark mode variables
$dark-bg: #1f2937;
$dark-border: #374151;
$dark-text: #f9fafb;
$dark-primary: #3b82f6;
$dark-primary-hover: #2563eb;

// ==================== UTILITY MIXINS ====================
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

@mixin flex-start {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
}

@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

@mixin flex-column {
  display: flex;
  flex-direction: column;
}

@mixin focus-state {
  border-color: var(--nxt-primary);
  box-shadow: var(--nxt-shadow-focus);
}

@mixin disabled-state {
  opacity: 0.6;
  cursor: not-allowed;
  pointer-events: none;
}

@mixin hover-state {
  border-color: var(--nxt-border-hover);
  background-color: var(--nxt-bg-light);
}

@mixin text-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}



// ==================== UTILITY CLASSES ====================
.nxt-flex-center { @include flex-center; }
.nxt-flex-between { @include flex-between; }
.nxt-flex-start { @include flex-start; }
.nxt-flex-column { @include flex-column; }
.nxt-text-truncate { @include text-truncate; }


// ==================== BASE COMPONENT STYLES ====================
.nxt-dropdown-container {
  position: relative;
  width: 100%;
  max-width: 100%;
  min-width: var(--nxt-min-width);
  box-sizing: border-box;
  font-family: var(--nxt-font-family);
  font-size: var(--nxt-font-size-base);
  line-height: var(--nxt-line-height);

  &.disabled {
    @include disabled-state;
  }

  &.required .nxt-dropdown-trigger {
    border-color: var(--nxt-error);
  }

  &.open .nxt-dropdown-trigger {
    @include focus-state;
  }

  &.multiple {
    .nxt-dropdown-option {
      padding-left: calc(var(--nxt-spacing-md) + 24px);
    }
  }

  // ==================== LABEL MODES ====================
  &.infield-label {
    position: relative;
    
    .nxt-dropdown-trigger {
      position: relative;
    }

    .nxt-dropdown-iftalabel-infield {
      position: absolute;
      left: var(--nxt-spacing-sm);
      top: 2px;
      font-size: var(--nxt-font-size-sm);
      color: var(--nxt-text-secondary);
      background-color: var(--nxt-bg-white);
      padding: 0 var(--nxt-spacing-xs);
      pointer-events: none;
      z-index: 1;
      opacity: 0.7;
      
      &.active, .open & {
        color: var(--nxt-primary);
        opacity: 1;
      }
      

    }

    .nxt-dropdown-iftalabel-onfield {
      position: absolute;
      left: var(--nxt-spacing-sm);
      top: -8px;
      font-size: var(--nxt-font-size-xs);
      color: var(--nxt-text-secondary);
      background-color: var(--nxt-bg-white);
      padding: 0 var(--nxt-spacing-xs);
      pointer-events: none;
      z-index: 1;
    }
  }

  &.floatlabel {
    .nxt-dropdown-trigger {
      position: relative;
      min-height: var(--nxt-min-height);
      height: var(--nxt-min-height); // Fixed height to prevent container expansion
      
      .nxt-dropdown-trigger-content {
        padding-top: 16px; // Add space for floatlabel
        height: 100%; // Ensure content takes full height
        display: flex;
        align-items: center;
      }
    }

    // Specific height for infield float label
    &.infield-floatlabel {
      .nxt-dropdown-trigger {
        min-height: 45px; // Increased height for infield float label
        height: 45px; // Increased height for infield float label
      }
    }

    .nxt-dropdown-floatlabel-onfield {
      position: absolute;
      left: var(--nxt-spacing-sm);
      top: 50%; // Center vertically initially
      transform: translateY(-50%); // Center vertically initially
      font-size: var(--nxt-font-size-base);
      color: var(--nxt-text-secondary);
      background-color: var(--nxt-bg-white);
      padding: 0 var(--nxt-spacing-xs);
      pointer-events: none;
      z-index: 1;
      transition: var(--nxt-transition);
      transform-origin: left top;
      
      &.active, .open & {
        color: var(--nxt-primary);
        transform: scale(0.85) translateY(-20px);
        font-size: var(--nxt-font-size-sm);
      }
    }

    .nxt-dropdown-floatlabel-infield {
      position: absolute;
      left: var(--nxt-spacing-sm);
      top: 50%; // Center vertically initially
      transform: translateY(-50%); // Center vertically initially
      font-size: var(--nxt-font-size-base);
      color: var(--nxt-text-secondary);
      background-color: var(--nxt-bg-white);
      padding: 0 var(--nxt-spacing-xs);
      pointer-events: none;
      z-index: 1;
      transition: var(--nxt-transition);
      transform-origin: left top;
      
      &.active, .open & {
        color: var(--nxt-primary);
        transform: scale(0.85) translateY(-22px);
        font-size: var(--nxt-font-size-sm);
      }
    }
  }
}

// ==================== CUSTOM TRIGGER WRAPPER ====================
.nxt-dropdown-custom-trigger-wrapper {
  width: 100%;
  cursor: pointer;
}

// ==================== TRIGGER STYLES ====================
.nxt-dropdown-trigger {
  @include flex-between;
  width: 100%;
  min-height: var(--nxt-min-height);
  height: var(--nxt-min-height); // Ensure consistent height
  padding: var(--nxt-spacing-sm) var(--nxt-spacing-md);
  border: var(--nxt-border-width) solid var(--nxt-border);
  border-radius: var(--nxt-border-radius);
  background-color: var(--nxt-bg-white);
  color: var(--nxt-text-primary);
  font-size: var(--nxt-font-size-base);
  cursor: pointer;
  transition: var(--nxt-transition);
  box-sizing: border-box;

  &:hover:not(.disabled) {
    @include hover-state;
  }

  &:focus {
    outline: none;
    @include focus-state;
  }

  &.disabled {
    @include disabled-state;
  }

  .nxt-dropdown-trigger-content {
    @include flex-start;
    flex: 1;
    min-width: 0;
    gap: var(--nxt-spacing-sm);
    overflow: hidden; // Prevent content overflow
    
    &.nxt-dropdown-trigger-content-with-infield {
      padding-top: 16px;
    }
    &.nxt-dropdown-trigger-content-with-infield-floatlabel {
      padding-top: 16px;
      align-items: flex-start; // Align content to top when label is floating
    }
  }

  .nxt-dropdown-trigger-text {
    @include text-truncate;
    flex: 1;
    overflow: hidden; // Ensure text doesn't cause height expansion
  }

  .nxt-dropdown-trigger-icon {
    @include flex-center;
    width: 16px;
    height: 16px;
    transition: var(--nxt-transition);
    color: var(--nxt-text-secondary);
    
    .open & {
      transform: rotate(180deg);
    }
  }
}

// ==================== PLACEHOLDER AND SELECTED TEXT ====================
.nxt-dropdown-placeholder {
  color: var(--nxt-text-secondary);
  font-style: italic;
}

.nxt-dropdown-selected {
  color: var(--nxt-text-primary);
  font-weight: 500;
}

.nxt-dropdown-empty {
  height: 0; // Ensure empty content doesn't take space
  visibility: hidden;
}

// ==================== PANEL STYLES ====================
.nxt-dropdown-panel {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  z-index: var(--nxt-z-dropdown);
  background-color: var(--nxt-bg-white);
  border: var(--nxt-border-width) solid var(--nxt-border);
  border-radius: var(--nxt-border-radius);
  box-shadow: var(--nxt-shadow-lg);
  max-height: var(--nxt-max-height);
  overflow: hidden;
  margin-top: var(--nxt-spacing-xs);

  &.above {
    top: auto;
    bottom: 100%;
    margin-top: 0;
    margin-bottom: var(--nxt-spacing-xs);
  }

  .nxt-dropdown-search {
    padding: var(--nxt-spacing-md);
    border-bottom: var(--nxt-border-width) solid var(--nxt-border);

    .nxt-dropdown-search-input {
      width: 100%;
      padding: var(--nxt-spacing-sm);
      border: var(--nxt-border-width) solid var(--nxt-border);
      border-radius: var(--nxt-border-radius-sm);
      font-size: var(--nxt-font-size-base);
      
      &:focus {
        outline: none;
        @include focus-state;
      }
    }
  }

  .nxt-dropdown-options {
    max-height: calc(var(--nxt-max-height) - 60px);
    overflow-y: auto;
  }

  .nxt-dropdown-confirmation {
    @include flex-between;
    padding: var(--nxt-spacing-md);
    border-top: var(--nxt-border-width) solid var(--nxt-border);
    background-color: var(--nxt-bg-light);
  }
}

// ==================== OPTION STYLES ====================
.nxt-dropdown-option {
  @include flex-between;
  padding: var(--nxt-spacing-sm) var(--nxt-spacing-md);
  cursor: pointer;
  transition: var(--nxt-transition);
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  font-size: var(--nxt-font-size-base);
  color: var(--nxt-text-primary);

  &:hover:not(.disabled) {
    background-color: var(--nxt-bg-light);
  }

  &.selected {
    background-color: var(--nxt-primary-light);
    color: var(--nxt-primary);
  }

  &.partially-selected {
    background-color: var(--nxt-primary-lighter);
    color: var(--nxt-primary);
  }

  &.disabled {
    @include disabled-state;
    color: var(--nxt-text-muted);
  }

  &.grouped {
    padding-left: calc(var(--nxt-spacing-md) * 2);
  }

  .nxt-dropdown-option-content {
    @include flex-start;
    flex: 1;
    gap: var(--nxt-spacing-sm);
  }

  .nxt-dropdown-option-text {
    @include text-truncate;
    flex: 1;
  }

  .nxt-dropdown-option-icon {
    @include flex-center;
    width: 16px;
    height: 16px;
    color: var(--nxt-primary);
  }
}

// ==================== ALL OPTION STYLES ====================
.nxt-dropdown-all-option {
  font-weight: 600;
  border-bottom: var(--nxt-border-width) solid var(--nxt-border);
  
  &:hover {
    background-color: var(--nxt-bg-lighter);
  }
}

// ==================== CHECKBOX STYLES ====================
.nxt-dropdown-checkbox {
  @include flex-center;
  width: 16px;
  height: 16px;
  border: 2px solid var(--nxt-border);
  border-radius: var(--nxt-border-radius-sm);
  background-color: var(--nxt-bg-white);
  transition: var(--nxt-transition);

  &.checked {
    background-color: var(--nxt-primary);
    border-color: var(--nxt-primary);
  }

  &.partially {
    background-color: var(--nxt-primary);
    border-color: var(--nxt-primary);
  }

  svg {
    width: 12px;
    height: 12px;
  }
}

// ==================== GROUP STYLES ====================
.nxt-dropdown-group {
  .nxt-dropdown-group-header {
    @include flex-between;
    padding: var(--nxt-spacing-sm) var(--nxt-spacing-md);
    background-color: var(--nxt-bg-lighter);
    font-size: var(--nxt-font-size-sm);
    font-weight: 600;
    color: var(--nxt-text-secondary);
    border-bottom: var(--nxt-border-width) solid var(--nxt-border);
  }

  .nxt-dropdown-group-options {
    .nxt-dropdown-option {
      padding-left: calc(var(--nxt-spacing-md) * 2);
    }
  }
}

// ==================== DIVIDER STYLES ====================
.nxt-dropdown-divider {
  height: 1px;
  background-color: var(--nxt-border);
  margin: var(--nxt-spacing-xs) 0;
}

// ==================== NO OPTIONS STYLES ====================
.nxt-dropdown-no-options {
  @include flex-center;
  padding: var(--nxt-spacing-lg);
  color: var(--nxt-text-secondary);
  font-style: italic;
  text-align: center;
}

// ==================== BUTTON STYLES ====================
.nxt-dropdown-btn {
  @include flex-center;
  gap: var(--nxt-spacing-xs);
  padding: var(--nxt-spacing-sm) var(--nxt-spacing-md);
  border: var(--nxt-border-width) solid var(--nxt-border);
  border-radius: var(--nxt-border-radius-sm);
  background-color: var(--nxt-bg-white);
  color: var(--nxt-text-primary);
  font-size: var(--nxt-font-size-base);
  cursor: pointer;
  transition: var(--nxt-transition);

  &:hover {
    @include hover-state;
  }

  &.nxt-dropdown-btn-cancel {
    background-color: var(--nxt-bg-white);
    color: var(--nxt-text-secondary);
    border-color: var(--nxt-border);

    &:hover {
      background-color: var(--nxt-bg-light);
      color: var(--nxt-text-primary);
    }
  }

  &.nxt-dropdown-btn-apply {
    background-color: var(--nxt-primary);
    color: var(--nxt-bg-white);
    border-color: var(--nxt-primary);

    &:hover {
      background-color: var(--nxt-primary-hover);
      border-color: var(--nxt-primary-hover);
    }
  }

  .nxt-dropdown-btn-icon {
    @include flex-center;
    width: 16px;
    height: 16px;
    
    svg {
      width: 14px;
      height: 14px;
    }
  }
}

// ==================== RESPONSIVE DESIGN ====================
@media (max-width: 768px) {
  .nxt-dropdown-container {
    min-width: 100%;
  }
  
  .nxt-dropdown-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    max-width: 400px;
    max-height: 70vh;
  }
}

// ==================== ACCESSIBILITY ====================
.nxt-dropdown-container {
  &:focus-within {
    .nxt-dropdown-trigger {
      @include focus-state;
    }
  }
}

.nxt-dropdown-option {
  &:focus {
    outline: none;
    @include focus-state;
  }
}

// ==================== ANIMATIONS ====================
@keyframes nxt-fade-in {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.nxt-dropdown-panel {
  animation: nxt-fade-in var(--nxt-transition);
}

@keyframes nxt-scale-in {
  from {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.nxt-dropdown-float-label.active {
  animation: nxt-scale-in var(--nxt-transition);
}

